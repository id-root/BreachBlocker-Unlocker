
## ðŸ”‘ Side Quest 4 â€“ Decryption Key Analysis

To begin this side quest, download the **malicious HTA file** from the official TryHackMe room:

> https://tryhackme.com/room/htapowershell-aoc2025-p2l5k8j1h4

This HTA file implements a **multi-stage obfuscation and payload delivery chain** designed to evade casual inspection. Each stage progressively reveals the next layer of the payload.

### ðŸ§© Obfuscation Stages Breakdown

#### **Stage 1 â€“ VBScript (HTA Layer)**
- The HTA file embeds **VBScript** code.
- A PowerShell payload is split into multiple strings and stored in the variable `p`.
- These strings are concatenated at runtime to form a **Base64-encoded PowerShell script**, hiding the real logic from static analysis.

#### **Stage 2 â€“ PowerShell Loader**
- Once decoded, the PowerShell script defines:
  - An **XOR key** (`$k = 23`)
  - A Base64-encoded blob (`$d`) containing encrypted data
- The script decodes the Base64 blob and applies an XOR operation using the key to recover the original payload.

#### **Stage 3 â€“ XOR-Decrypted Payload**
- The decrypted output begins with the PNG magic bytes (`89 50 4E 47 0D 0A 1A 0A`), that confirm us that the payload is an image.
- This PNG file is concealed using a **single-byte XOR cipher** with key `23`.
